<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Ứng Dụng Phân Loại Các Giống Chó, Mèo - Hai-Blog</title><meta name="Description" content="Ứng dụng phân loại các giống chó, mèo"><meta property="og:title" content="Ứng Dụng Phân Loại Các Giống Chó, Mèo" />
<meta property="og:description" content="Ứng dụng phân loại các giống chó, mèo" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sanhobk.github.io/classification/" />
<meta property="og:image" content="https://sanhobk.github.io/classification/x.jpg"/>
<meta property="article:published_time" content="2020-11-02T02:01:56+07:00" />
<meta property="article:modified_time" content="2020-11-02T02:01:56+07:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sanhobk.github.io/classification/x.jpg"/>
<meta name="twitter:title" content="Ứng Dụng Phân Loại Các Giống Chó, Mèo"/>
<meta name="twitter:description" content="Ứng dụng phân loại các giống chó, mèo"/>
<meta name="application-name" content="San Hô">
<meta name="apple-mobile-web-app-title" content="San Hô"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://sanhobk.github.io/classification/" /><link rel="prev" href="https://sanhobk.github.io/basicmarkdownsyntax/" /><link rel="next" href="https://sanhobk.github.io/objectdetectionyolo/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Ứng Dụng Phân Loại Các Giống Chó, Mèo",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/sanhobk.github.io\/classification\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/sanhobk.github.io\/classification\/x.jpg",
                            "width":  1430 ,
                            "height":  951 
                        }],"genre": "posts","keywords": "AI, Deep Learning, Machine Learning, Pytorch, Classification","wordcount":  1684 ,
        "url": "https:\/\/sanhobk.github.io\/classification\/","datePublished": "2020-11-02T02:01:56+07:00","dateModified": "2020-11-02T02:01:56+07:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/sanhobk.github.io\/images\/avatar.png",
                    "width":  528 ,
                    "height":  528 
                }},"author": {
                "@type": "Person",
                "name": "Hải Nguyễn"
            },"description": "Ứng dụng phân loại các giống chó, mèo"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Hai-Blog"><span class="header-title-pre"><i class='far fa-smile fa-fw'></i></span>San Hô</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/categories/documentation/"> Docs </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/sanhobk" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/classification/" selected>English</option><option value="/vi/classification/">Vietnamese</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Hai-Blog"><span class="header-title-pre"><i class='far fa-smile fa-fw'></i></span>San Hô</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/categories/documentation/" title="">Docs</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/sanhobk" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/classification/" selected>English</option><option value="/vi/classification/">Vietnamese</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Ứng Dụng Phân Loại Các Giống Chó, Mèo</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/sanhobk" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Hải Nguyễn</a></span>&nbsp;<span class="post-category">included in <a href="/categories/ai-project/"><i class="far fa-folder fa-fw"></i>AI Project</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-11-02">2020-11-02</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1684 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/classification/x.jpg"
        data-srcset="/classification/x.jpg, /classification/x.jpg 1.5x, /classification/x.jpg 2x"
        data-sizes="auto"
        alt="/classification/x.jpg"
        title="Ứng dụng phân loại các giống chó, mèo" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#bi-ton-phn-lp-trong-machine-learning---ng-dng-nhn-din-cc-ging-ch-mo">BÀI TOÁN PHÂN LỚP TRONG MACHINE LEARNING - ỨNG DỤNG NHẬN DIỆN CÁC GIỐNG CHÓ, MÈO</a>
      <ul>
        <li><a href="#1--chun-b-tp-d-liu-hun-luyn">1.  Chuẩn bị tập dữ liệu huấn luyện</a></li>
        <li><a href="#2-xy-dng-m-hnh-phn-lp-to-network">2. Xây dựng mô hình phân lớp, tạo network</a></li>
        <li><a href="#3-training">3. Training</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="bi-ton-phn-lp-trong-machine-learning---ng-dng-nhn-din-cc-ging-ch-mo">BÀI TOÁN PHÂN LỚP TRONG MACHINE LEARNING - ỨNG DỤNG NHẬN DIỆN CÁC GIỐNG CHÓ, MÈO</h2>
<p>Bài  toán  phân  lớp (classification) là  một  trong  những  bài  toán  lớn  trong  lĩnh  vực Machine Learnig (ML). Classification  là  quá  trình  phân  lớp  một  đối  tượng  dữ  liệu  vào  một hay nhiều  lớp  đã  cho  trước  nhờ  một  mô  hình  phân  lớp (classification model). Mô  hình  này  được  xây  dựng  dựa  trên  một  tập  dữ  liệu  được  xây  dựng  trước  đó (hay còn  gọi  là  tập  huấn  luyện). Quá  trình  phân  lớp  là  quá  trình  gán  nhãn  cho  đối  tượng  dữ  liệu.</p>
<p>Có  nhiều  bài  toán  phân  lớp  dữ  liệu  như  phân  lớp  nhị  phân (binary), phân  lớp  đa  lớp (multiclass),&hellip;:</p>
<ul>
<li><strong>Bài  toán  phân  lớp  nhị  phân</strong>  là  bài  toán  gắn  nhãn  dữ  liệu  cho  đối  tượng  vào  một  trong  hai  lớp  khác  nhau  dựa  vào  việc  dữ  liệu  dó  có hay không  các  đặc  trưng (feature) của  bộ  phân  lớp.</li>
<li><strong>Bài  toán  phân  lớp  đa  lớp</strong>  là  quá  trình  phân  lớp  dữ  liệu  với  số  lượng  lớp  lớn  hơn  hai. Như  vậy  với  từng  dữ  liệu  chúng ta phải  xem  xét  và  phân  lớp  chúng  vào  những  lớp  khác  nhau  chứ  không  phải  là  hai  lớp  như  bài  toán  phân  lớp  nhị  phân. Và  thực  chất  bài  toán  phân  lớp  nhị  phân  là  một  bài  toán  đặt  biệt  của  phân  lớp  đa  lớp.</li>
</ul>
<p>Ứng  dụng  của  bài  toán  này  được  sử  dụng  rất  nhiều  và  rộng  rãi  trong  thực  tế  ví  dụ  như  bài  toán  nhận  dạng  khuôn  mặt, nhận  diện  giọng  nói, phát  hiện email spam…</p>
<p>Và  đối  với  các  bài  toán  phân  lớp  dữ  liệu  chúng ta sử  dụng  các  thuật  toán  học  có  giám  sát (supervised learning) để  xây  dựng  mô  hình  cho  bài  toán  này.</p>
<p>Sau đây mình sẽ hướng dẫn các bạn cách xây dựng một project <em>&ldquo;Nhận diện, phân loại các giống chó mèo&rdquo;</em> từ A-Z sử dụng bộ dữ liệu thực tế.
Bài toán mình giới thiệu ở đây thuộc dạng phân lớp đa lớp (multi classification) sử dụng Farmework pytorch, ngôn ngữ python và tkinter để tạo giao diện cho ứng dụng. 
Okay, bắt đầu thôi nhỉ :D</p>
<h3 id="1--chun-b-tp-d-liu-hun-luyn">1.  Chuẩn bị tập dữ liệu huấn luyện</h3>
<p>Bộ  dữ  liệu  mình  sử  dụng  để  phân  loại  giống  chó, mèo các bạn có thể tải về tại đây :
<a href="http://www.robots.ox.ac.uk/~vgg/data/pets/?fbclid=IwAR2BOAKYc3FE24S5Um9xXwK-qan3OFjutcmE0gm8dP4zBtZqwxpQzIA-yaI" target="_blank" rel="noopener noreffer">Pets Dataset</a></p>
<blockquote>
<p>Tập dữ liệu gồm 37 loại vật nuôi và khoảng 200 ảnh cho mỗi loại.</p>
</blockquote>
<p>Sau khi tải dataset về ta tạo một folder data chia lại các thư mục như sau: 
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="2.png"
        data-srcset="/classification/2.png, 2.png 1.5x, /classification/2.png 2x"
        data-sizes="auto"
        alt="/classification/2.png"
        title="data" /></p>
<p>Trong thư mục train và val, sẽ chứa các thư mục con có tên các loài và ảnh của chúng:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="3.png"
        data-srcset="/classification/3.png, 3.png 1.5x, /classification/3.png 2x"
        data-sizes="auto"
        alt="/classification/3.png"
        title="data" />
Mình chia tập  dữ  liệu  thành 2 phần : training và validation để  phục  vụ  cho  mục  đích training và  kiểm  tra  độ  chính  xác. 
Đầu tiên, khai báo các thư viện sử dụng:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">osp</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="c1"># %matplotlib inline</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="kn">as</span> <span class="nn">optim</span>
<span class="kn">import</span> <span class="nn">torch.utils.data</span> <span class="kn">as</span> <span class="nn">data</span>
<span class="kn">import</span> <span class="nn">torchvision</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">argparse</span> 
</code></pre></td></tr></table>
</div>
</div><p>tạo một class <em>ImageTransform</em>, nó sẽ làm nhiệm vụ tiền xử lý các bức ảnh như resize, flipflop, rotate, &hellip;. về dạng tiêu chuẩn:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## imagetransform</span>
<span class="k">class</span> <span class="nc">ImageTransform</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resize</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">train</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="p">[</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomResizedCrop</span><span class="p">(</span><span class="n">resize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
            <span class="p">]</span><span class="p">)</span><span class="p">,</span>
            
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">val</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="p">[</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">resize</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">CenterCrop</span><span class="p">(</span><span class="n">resize</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
            <span class="p">]</span><span class="p">)</span><span class="p">,</span>

            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">test</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="p">[</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">resize</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
            <span class="p">]</span><span class="p">)</span><span class="p">,</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">train</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_transform</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Tiếp theo, viết hàm <em>make_data_path_list</em> để tạo một list chứa đường dẫn của ảnh.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## datapath</span>
<span class="k">def</span> <span class="nf">make_datapath_list</span><span class="p">(</span><span class="n">phase</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="n">rootpath</span> <span class="o">=</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">./data/</span><span class="s2">&#34;</span>
    <span class="n">target_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootpath</span><span class="o">+</span><span class="n">phase</span><span class="o">+</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">/*/*.jpg</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="n">path_list</span> <span class="o">=</span> <span class="p">[</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">target_path</span><span class="p">)</span><span class="p">:</span>
        <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">path_list</span>
</code></pre></td></tr></table>
</div>
</div><p>Cuối cùng tạo class <em>MyDataset</em>, nó sẽ lấy ảnh bằng <em>make_data_path_list</em> ,trả về ảnh đã được qua tiền xử lý bởi <em>ImageTransform</em>  và nhãn (label) mà chúng ta sẽ gán vào ảnh:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## dataset</span>
<span class="k">class</span> <span class="nc">MyDataset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span><span class="p">:</span>
 <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_list</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
     
 <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
     <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span>

 <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span><span class="p">:</span>
     <span class="n">img_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
     <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">RGB</span><span class="s1">&#39;</span><span class="p">)</span>

     <span class="n">img_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
     
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="n">img_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
         <span class="c1"># print(label)</span>
     <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">val</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="n">img_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="se">\\</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
         <span class="c1"># print(label)</span>
     <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Abyssinian</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">0</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">american_bulldog</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">american_pitbull</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">2</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">basset_hound</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">3</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">beagle</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">4</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Bengal</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">5</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Birman</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">6</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Bombay</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">7</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Boxer</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">8</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">British_Shorthair</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">9</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Chihuahua</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">10</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Egyptian_Mau</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">11</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">English_Cocker_Spaniel</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">12</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">English_Setter</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">13</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">German_Shorthaired</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">14</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Great_Pyrenees</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">15</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Havanese</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">16</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Japanese_Chin</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">17</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Keeshond</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">18</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Leonberger</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">19</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Main_Coon</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">20</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Miniature_Pinscher</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">21</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Newfoundland</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">22</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Persian</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">23</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Pomeranian</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">24</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Pug</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">25</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Ragdoll</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">26</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Russian_Blue</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">27</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Saint_Bernard</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">28</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Samoyed</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">29</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Scottish_Terrier</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">30</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Shiba_Inu</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">31</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Siamese</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">32</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Sphynx</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">33</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Staffordshire_Bull_Terrier</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">34</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Wheaten_Terrier</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">35</span>
     <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Yorkshire_Terrier</span><span class="s2">&#34;</span><span class="p">:</span>
         <span class="n">label</span> <span class="o">=</span> <span class="mi">36</span>
     <span class="k">return</span> <span class="n">img_transformed</span><span class="p">,</span> <span class="n">label</span>

<span class="n">train_list</span> <span class="o">=</span> <span class="n">make_datapath_list</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="n">val_list</span> <span class="o">=</span> <span class="n">make_datapath_list</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">val</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">train_list</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ImageTransform</span><span class="p">(</span><span class="n">resize</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span><span class="p">,</span><span class="n">phase</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">train</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">val_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">ImageTransform</span><span class="p">(</span><span class="n">resize</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span><span class="p">,</span><span class="n">phase</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">val</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">img</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Tạo dataloader để load một nhóm ảnh từ dataset vào model:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## dataloader</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">val_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">dataloader_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">:</span><span class="n">train_dataloader</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">val</span><span class="s2">&#34;</span><span class="p">:</span><span class="n">val_dataloader</span><span class="p">}</span>
<span class="n">batch_iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dataloader_dict</span><span class="p">[</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">]</span><span class="p">)</span>
<span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">batch_iterator</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="2-xy-dng-m-hnh-phn-lp-to-network">2. Xây dựng mô hình phân lớp, tạo network</h3>
<p>Xây dựng mô hình phân lớp (Classifier Model) hay còn  gọi  là  mô  hình  huấn  luyện, thông  thường  để  xây  dựng  mô  hình phân  lớp  cho  bài  toán  này  chúng ta thường  sử  dụng  các  thuật  toán  học  có giám  sát (supervised learning) như KNN, Neural network, SVM, Decision Tree, Navie  Bayers&hellip;
Ở đây mình sử dụng mạng VGG16, một mô hình đã được huấn luyện sẵn và sử dụng kỹ thuật finetunning để transform lại hàm linear cho hợp với bài toán đang sử dụng:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## network</span>
<span class="n">use_pretrained</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">vgg16</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="n">use_pretrained</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">classifier</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">37</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Định nghĩa hàm Loss và thiết lập Optomizer:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="c1">## lossfunction</span>
<span class="n">criterior</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="p">)</span>
<span class="n">params_to_update</span> <span class="o">=</span> <span class="p">[</span><span class="p">]</span>

<span class="n">update_params_name</span> <span class="o">=</span> <span class="p">[</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">classifier.6.weight</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">classifier.6.bias</span><span class="s2">&#34;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">update_params_name</span><span class="p">:</span>
        <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">params_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params_to_update</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="3-training">3. Training</h3>
<p>Sau khi đã  tìm  được  mô  hình  phân  lớp ở bước 2, thì ở đây  chúng ta bắt đầu quá trình huấn luyện, đánh  giá  mô  hình  bằng  cách  đánh  giá  mức  độ lỗi  của  dữ  liệu testing và  dữ  liệu  training  thông qua mô  hình  tìm  được. Nếu không  đạt  được  kết  quả  mong  muốn  thì  phải  thay  đổi  các tham  số (turning parameter) của  các  thuật  toán  học  để  tìm  ra  các  mô  hình tốt  hơn  và  kiểm  tra, đánh  giá  lại  mô  hình  phân  lớp. Và  cuối  cùng  chọn  ra mô  hình  phân  lớp tốt  nhất  cho  bài  toán  của  chúng ta.
dưới đây là code cho phần training:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">dataloader_dict</span><span class="p">,</span> <span class="n">criterior</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">)</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Epoch {}/{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">)</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="p">[</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">val</span><span class="s2">&#34;</span><span class="p">]</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">:</span>
                <span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="p">)</span>
                
            <span class="n">epoch_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">epoch_corrects</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dataloader_dict</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="p">)</span><span class="p">:</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">(</span><span class="p">)</span>
                
                <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
                    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterior</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">train</span><span class="s2">&#34;</span><span class="p">:</span>
                        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="p">)</span>
                        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="p">)</span>
                        
                    <span class="n">epoch_loss</span> <span class="o">+</span><span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="p">)</span><span class="o">*</span><span class="n">inputs</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">epoch_corrects</span> <span class="o">+</span><span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">preds</span><span class="o">==</span><span class="n">labels</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                    
            
            <span class="n">epoch_loss</span> <span class="o">=</span> <span class="n">epoch_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader_dict</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">epoch_accuracy</span> <span class="o">=</span> <span class="n">epoch_corrects</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader_dict</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
                    
            <span class="k">print</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">{} Loss: {:.4f} Acc: {:.4f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">epoch_loss</span><span class="p">,</span> <span class="n">epoch_accuracy</span><span class="p">)</span><span class="p">)</span>

<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">train_model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">dataloader_dict</span><span class="p">,</span> <span class="n">criterior</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Sau quá trình huấn luyện độ chính xác đạt được khoảng tầm 90%, không cao nhưng mình khá hài lòng với kết quả này với bộ dữ liệu không nhiều ở trên.
Tạo giao diện, và dưới đây là thành quả:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="1.gif"
        data-srcset="/classification/1.gif, 1.gif 1.5x, /classification/1.gif 2x"
        data-sizes="auto"
        alt="/classification/1.gif"
        title="cat&amp;amp;dog" /></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-11-02</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/classification/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://sanhobk.github.io/classification/" data-hashtag="AI"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://sanhobk.github.io/classification/" data-title="Ứng Dụng Phân Loại Các Giống Chó, Mèo"><i class="fab fa-hacker-news fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/ai/">AI</a>,&nbsp;<a href="/tags/deep-learning/">Deep Learning</a>,&nbsp;<a href="/tags/machine-learning/">Machine Learning</a>,&nbsp;<a href="/tags/pytorch/">Pytorch</a>,&nbsp;<a href="/tags/classification/">Classification</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/basicmarkdownsyntax/" class="prev" rel="prev" title="Basic Markdown Syntax"><i class="fas fa-angle-left fa-fw"></i>Basic Markdown Syntax</a>
            <a href="/objectdetectionyolo/" class="next" rel="next" title="YOLO Và Các Thuật toán Object Detection">YOLO Và Các Thuật toán Object Detection<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="fb-root" class="comment"></div>
            <div
                class="fb-comments"
                data-href="https://sanhobk.github.io/classification/"
                data-width="100%"
                data-numposts="10"
            ></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://developers.facebook.com/docs/plugins/comments/"></a>Facebook</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">HaiNguyen</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v5.0&amp;appId=&amp;autoLogAppEvents=1" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"8DPW6V4XGR","algoliaIndex":"index.en","algoliaSearchKey":"6d651aa957c8afdcc75a4d9d614e8d42","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
